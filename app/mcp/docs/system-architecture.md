# MCPシステムアーキテクチャ

## 概要

MCP（Model Context Protocol）アプリケーションは、Cloudflare Workersで構築されたモダンなWebアプリケーションです。MCPツールとデータソースを管理する包括的な管理インターフェースを提供し、型安全性、アクセシビリティ、保守性を重視したコンポーネントベースアーキテクチャを採用しています。

## システム構成

### 高レベルアーキテクチャ

システムは4層構造で構成されています：

- **Cloudflare Workers**: サーバーレス実行環境
- **Honoフレームワーク**: Webアプリケーションフレームワーク
- **管理インターフェース**: ダッシュボード、MCPツール管理、データソース管理
- **コンポーネント層**: UIコンポーネント、アイコンライブラリ、レイアウトシステム
- **データ層**: モックデータ、型定義、APIルート

### 技術スタック

- **実行環境**: Cloudflare Workers
- **フレームワーク**: Hono.js
- **フロントエンド**: JSXによるサーバーサイドレンダリング
- **スタイリング**: Tailwind CSS + DaisyUI
- **インタラクティビティ**: HTMX
- **言語**: TypeScript
- **ビルドツール**: Vite
- **パッケージマネージャー**: PNPM（Turboによるワークスペース）
- **ワークフロー**: Cloudflare Workflows（データ同期用）
- **ストレージ**: Cloudflare R2 + Auto RAG

### コアコンポーネント

#### アプリケーション層

- エントリーポイント管理
- Honoベースルーティングシステム
- 認証、ログ、エラーハンドリングミドルウェア

#### 管理インターフェース

- **ダッシュボード**: システム概要と統計表示
- **MCPツール管理**: MCP検索ツールのCRUD操作
- **データソース管理**: データ取得ソースの設定

#### コンポーネントシステム

- **レイアウトコンポーネント**: 一貫したページ構造
- **UIコンポーネント**: 再利用可能コンポーネント
- **アイコンシステム**: アクセシビリティ対応の統一アイコンライブラリ

#### データ管理

- **型定義**: 全データ構造の強い型付け
- **モックデータ**: 開発用データの集約管理
- **API統合準備**: バックエンド統合の準備構造

## 機能設計

### ダッシュボードモジュール

**目的**: システム概要とナビゲーションハブの提供

**機能**:

- システム統計表示（MCPツール数、データソース数、最終更新日）
- 管理モジュールへの迅速アクセス
- カードベースの整理されたレイアウト

**コンポーネント**:

- Dashboard（メインコンポーネント）
- StatCard（統計表示）
- ManagementCard（ナビゲーションカード）

### MCPツール管理モジュール

**目的**: MCP検索ツール設定の管理

**機能**:

- 検索・フィルタリング機能付きツール一覧
- バリデーション付き新規ツール追加
- 既存ツールの編集・削除
- 使用期間ベースの最終使用追跡

**コンポーネント**:

- McpToolsManager（メインコンポーネント）
- StatCard（統計）
- CRUD操作用モーダルフォーム

### データソース管理モジュール

**目的**: データ取得ソースの設定

**機能**:

- データソース設定管理
- 複数データソースタイプ対応（text、firecrawl）
- 動的フォームフィールドによるデータソース追加
- ターゲットドキュメント関連付け

**コンポーネント**:

- DataSourcesManager（メインコンポーネント）
- StatCard（統計）
- 設定用動的フォームシステム

### アイコンシステム

**目的**: 統一されたアクセシブルなアイコン管理

**機能**:

- 13種類以上の再利用可能アイコン
- アクセシビリティファーストデザイン
- 柔軟なサイズ設定（sm、md、lg）
- カスタムスタイリング対応

### レイアウトシステム

**目的**: 一貫したページ構造とナビゲーション

**機能**:

- レスポンシブサイドバーナビゲーション
- HTMX強化ナビゲーション
- モバイル対応ドロワーシステム
- 一貫したヘッダーとブランディング

## データフロー

### 現在の状態（モックデータ）

モックデータ → コンポーネント状態 → UIレンダリング

### 将来の状態（API統合）

APIエンドポイント → データ取得 → 状態管理 → UIレンダリング
↓
HTMX強化フォーム → API呼び出し → 状態更新 → UI更新

### HTMX統合パターン

- フォーム送信がAPI呼び出しをトリガー
- ターゲット固有のDOM更新
- 進行状況表示とエラーハンドリング
- 適切な場合の楽観的UI更新

## セキュリティ考慮事項

### 入力検証

- 即座のフィードバック用クライアントサイド検証
- セキュリティのためのサーバーサイド検証
- 型安全なフォーム処理

### 認証・認可

- Cloudflare Accessとの統合準備
- ロールベースアクセス制御構造
- セキュアなセッション管理

### データサニタイゼーション

- 適切なエスケープによるXSS防止
- SQLインジェクション防止（将来のデータベース統合）
- 入力長制限とパターン検証

## パフォーマンス最適化

### サーバーサイドレンダリング

- 高速な初回バイト時間（TTFB）
- SEO対応マークアップ
- クライアントサイドJavaScriptの削減

### コンポーネント再利用性

- コード重複の最小化
- 一貫したレンダリングパターン
- 効率的なメモリ使用

### アセット最適化

- 最適化されたアイコンシステム
- TailwindによるCSSフットプリント最小化
- Viteによる圧縮アセット

## 関連ドキュメント

- **機能仕様書**: [feature-specifications.md](./feature-specifications.md) - 詳細機能要件
- **MCPサーバー設計**: [mcp-server.md](./mcp-server.md) - MCPプロトコル実装
- **データ同期システム**: [data-sync.md](./data-sync.md) - Workflowsベースのデータ同期
